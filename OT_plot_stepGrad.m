clear; close all; clc;
all_marks = {'o','*','s','^','p', '+'};

%%% gradient descent step verification
%%% ploting (E(phi_old) - E(phi))/(alpha*dE) vs alpha
%%% lambda initialized with lambda0 = @(x,y) 0.6 * ( x.^3/3 - x.^2/2 + y.^3/3 - y.^2/2 ) + 0.6/6;


%%%n=6, k=4 sans convexification
alpha_n6  = [4e-5 7e-5 1e-4, 1.3e-4, 1.5e-4, 1.75e-4, 2e-4, 2.5e-4, 3e-4, 4e-4, 5e-4, 6e-4, 7e-4, 8e-4, 9e-4, 1e-3,...
    1.2e-3, 1.5e-3, 2e-3, 3e-3, 4e-3, 5e-3, ...
  6e-3, 7e-3, 8e-3, 9e-3, 1e-2, 1.3e-2, 1.5e-2, 1.7e-2,...
  2e-2, 2.3e-2, 2.4e-2, 2.5e-2, 2.6e-2];

quotient_n6 = [0.5754, 0.8314, 0.9335, 0.9884, 1.0127, 1.0354, 1.0523, 1.0760, 1.0918, 1.1114, 1.1230, 1.1307, 1.1360, ...
    1.1400, 1.1431, 1.1455, 1.1491, 1.1524, 1.1555, 1.1474, 1.1358, 1.1229, 1.1129, 1.1062, 1.1019, 1.1000, 1.0996, 1.1096, ...
    1.1238, 1.1434, 1.1797, 1.2246, 1.2490, 1.2633, 1.2793];

%%%n=10, k=4 sans convexification
alpha_n10  = [1e-6 1.5e-6 2e-6 4e-6 7e-6 1e-5 2e-5 4e-5 7e-5 1e-4, 1.3e-4, 1.5e-4, 1.75e-4, 2e-4, 2.5e-4, 3e-4, 4e-4, 5e-4, 6e-4, 7e-4, 8e-4, 9e-4, 1e-3,...
    1.2e-3, 1.5e-3, 2e-3, 3e-3, 4e-3, 5e-3, ...
  6e-3, 7e-3, 8e-3, 9e-3, 1e-2, 1.3e-2, 1.5e-2, 1.7e-2,...
  2e-2, 2.3e-2, 2.4e-2, 2.5e-2, 2.6e-2];

quotient_n10 = [0.5074, 0.700543, 0.817394, 0.9652, 1.0446, 1.0782, 1.117364, 1.1370, 1.1452, 1.1484, 1.1501, 1.1508, 1.1515, 1.1519, 1.1525, 1.1528, 1.1529, 1.1529, 1.1527, ...
    1.1524, 1.1521, 1.1518, 1.1515, 1.1511, 1.1499, 1.1482, 1.1432, 1.1387, 1.1351, 1.1329, 1.1311, ...
    1.1297, 1.1289, 1.1292, 1.1366, 1.1473, 1.1626, 1.1940, 1.2366, 1.2531, 1.2707, 1.2896];

%%%n=8, k=4 sans convexification
alpha_n8  = [1e-7 3e-7 5e-7 6e-7 8e-7 1e-6 1.5e-6 2e-6 4e-6 7e-6 1e-5 2e-5 4e-5 7e-5 1e-4, 1.3e-4, 1.5e-4, 1.75e-4, 2e-4, 2.5e-4, 3e-4, 4e-4, 5e-4, 6e-4, 7e-4, 8e-4, 9e-4, 1e-3,...
    1.2e-3, 1.5e-3, 2e-3, 3e-3, 4e-3, 5e-3, ...
  6e-3, 7e-3, 8e-3, 9e-3, 1e-2, 1.3e-2, 1.5e-2, 1.7e-2,...
  2e-2, 2.3e-2 2.4e-2, 2.5e-2, 2.6e-2];

quotient_n8 = [0.4680, 0.4680, 0.6665, 1.1073, 1.2082, ...
1.2265, 1.2207, 1.2053, 1.1545, 1.1487, 1.1471, 1.1468, 1.1465, 1.1462, 1.1460, 1.1457, 1.1456, 1.1454, ...
    1.1452, 1.1448, 1.1445, 1.1438, 1.1430, 1.1423, 1.1416, 1.1409, 1.1403, 1.1396, 1.1384, 1.1365, 1.1334, 1.1285, ...
    1.1227, 1.1171, 1.1120, 1.1206, 1.1203, 1.1186, 1.1173, 1.1123, 1.1290, 1.1431, 1.1690, 1.2046 ...
    1.2186, 1.2346, 1.2525];

%%%n=16, k=3 sans convexification
alpha_n16_3  = [1e-7 3e-7 5e-7 6e-7 8e-7 1e-6 1.5e-6 2e-6 4e-6 7e-6 1e-5 2e-5 4e-5 7e-5 1e-4, 1.3e-4, 1.5e-4, 1.75e-4, 2e-4, 2.5e-4, 3e-4, 4e-4, 5e-4, 6e-4, 7e-4, 8e-4, 9e-4, 1e-3,...
    1.2e-3, 1.5e-3, 2e-3, 3e-3, 4e-3, 5e-3, ...
  6e-3, 7e-3, 8e-3, 9e-3, 1e-2, 1.3e-2, 1.5e-2, 1.7e-2,...
  2e-2, 2.3e-2, 2.4e-2, 2.5e-2, 2.6e-2];


quotient_n16_3 = [0.4847, 0.4847, 0.6554, 1.084099, 1.2292, 1.2408, 1.2316, 1.2227, 1.1687, 1.1631, 1.1624, 1.1621, 1.1621, 1.1619, 1.1618, 1.1628, 1.1633, 1.1638, 1.1641, ...
    1.1641, 1.1640, 1.1635, 1.1631, 1.1626, 1.1622, 1.1618, 1.1614, 1.1610, 1.1604, 1.1593, 1.1575, 1.1569, 1.1551, 1.1532, ...
    1.1425, 1.1382, 1.1354, 1.1348, 1.1357, 1.1478, 1.1638, 1.1612, 1.1897, 1.2326, 1.2507, 1.2720, 1.2948];





%%%%%%%%%%%%%%%%%%% calcul dE avec dPhi_xi %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%Ã¹

alpha_list = [1e-6 1.5e-6 2e-6 4e-6 7e-6 1e-5 2e-5 4e-5 7e-5 1e-4, 1.3e-4, 1.5e-4, 1.75e-4, 2e-4, 2.5e-4, 3e-4, 4e-4, 5e-4, 6e-4, 7e-4, 8e-4, 9e-4, 1e-3,...
    1.2e-3, 1.5e-3, 2e-3, 3e-3, 4e-3, 5e-3, ...
  6e-3, 7e-3, 8e-3, 9e-3, 1e-2, 1.3e-2, 1.5e-2, 1.7e-2,...
  2e-2, 2.3e-2, 2.4e-2, 2.5e-2, 2.6e-2];



%%%n=6, k=4
alpha_n6  = alpha_list;
%with dE^(2) && homogeneous Neumann b.c
quotient_n6 = [0.9806,0.9806,0.9806,0.9806,0.9806,0.9806,0.9806,0.9805,0.9805,0.9805,0.9804,0.9804,0.9804,0.9804, ...
    0.9803,0.9803,0.9802,0.9801,0.9801,0.9800,0.9800,0.9800,0.9800,0.9800,0.9801,0.9806,0.9824,0.9854,0.9896,0.9949, ...
    1.0013,1.0089,1.0176,1.0274,1.0636,1.0932,1.1274,1.1869,1.2565,1.2819,1.3084,1.3360];

%with dE^(1) && homogeneous Neumann b.c
quotient_n6 = [0.9723,0.9723,0.9723,0.9723,0.9722,0.9722,0.9720,0.9717,0.9713,0.9709,0.9704,0.9702,0.9698,0.9694,0.9687, ...
    0.9680,0.9666,0.9651,0.9637,0.9623,0.9608,0.9594,0.9580,0.9552,0.9510,0.9441,0.9306,0.9175,0.9048,0.8924,0.8804, ...
    0.8688,0.8575,0.8465,0.8157,0.7967,0.7789,0.7544,0.7323,0.7255,0.7189,0.7125];

%with dE^(1) && homogeneous Neumann b.c
% quotient_n6 = [0.9613,0.9613,0.9613,0.9613,0.9612,0.9612,0.9611,0.9608,0.9604,0.9600,0.9597,0.9594,0.9591,0.9588,0.9581,0.9575, ...
%     0.9562,0.9549,0.9537,0.95240, 0.9512,0.9499,0.9487,0.9462,0.9424,0.9363,0.9242,0.9124,0.9008,0.8896,0.8786,0.8679,0.8574, ...
%     0.8472,0.8181,0.7999,0.7826,0.7584,0.7361,0.7291,0.7223,0.7157];

%%%n=10, k=4 
alpha_n10  = alpha_list;
quotient_n10 = [1.0067,1.0067,1.0067,1.0067,1.0067,1.0067,1.0067,1.0067,1.0066,1.0066,1.0066,1.0066,1.0066,1.0066, ...
    1.0066,1.0066,1.0066,1.0066,1.0067,1.0067,1.0068,1.0068,1.0069,1.0071,1.0074,1.0082,1.0105,1.0139,1.0183,1.0238,1.0302, ...
    1.0376,1.0460,1.0554,1.0894,1.1168,1.1480,1.2018,1.2636,1.2859,1.3090,1.3328];

quotient_n10 = [0.9862,0.9862,0.9862,0.9861,0.9861,0.9860,0.9859,0.9856,0.9851,0.9846,0.9842,0.9839,0.9835,0.9831,0.9823,0.9816, ...
    0.9800,0.9785,0.9770,0.9755,0.9740,0.9725,0.9710,0.9680,0.9635,0.9562,0.9418,0.9278,0.9142,0.9011,0.8883,0.8759,0.8639, ...
    0.8522,0.8193,0.7990,0.7800,0.7537,0.7299,0.7225,0.7154,0.7085];


%%%n=8, k=4 
alpha_n8  = alpha_list;
quotient_n8 =[1.0186,1.0186,1.0186,1.0186,1.0186,1.0186,1.0186,1.0186,1.0186,1.0185,1.0185,1.0185,1.0185,1.0185,1.0184, ...
    1.0184,1.0184,1.0183,1.0183,1.0183,1.0183,1.0183,1.0183,1.0184,1.0186,1.0191,1.0211,1.0241,1.0282,1.0334,1.0397,1.0470, ...
    1.0554,1.0647,1.0989,1.1266,1.1582,1.2125,1.2747,1.2970,1.3202,1.3440];

quotient_n8  = [1.0087,1.0087,1.0087,1.0086,1.0086,1.0085,1.0084,1.0081,1.0076,1.0071,1.0066,1.0063,1.0059,1.0055,1.0047, ...
    1.0039,1.0023,1.0007,0.9991,0.9975,0.9959,0.9943,0.9927,0.9896,0.9849,0.9772,0.9620,0.9472,0.9328,0.9188,0.9052,0.8919, ...
    0.8789,0.8664,0.8307,0.8087,0.7879,0.7591,0.7330,0.7249,0.7170,0.7094];


%%%n=16, k=3
alpha_n16_3  = alpha_list;
quotient_n16_3 = [1.0101,1.0101,1.0101,1.0101,1.0101,1.0101,1.0101,1.0100,1.0100,1.0100,1.0100,1.0100,1.0100,1.0100,1.0100, ...
    1.0100,1.0100,1.0100,1.0101,1.0101,1.0102,1.0102,1.0103,1.0105,1.0109,1.0117,1.0142,1.0178,1.0224,1.0282,1.0349,1.0427, ...
    1.0515,1.0613,1.0969,1.1255,1.1580,1.2137,1.2774,1.3003,1.3240,1.3484];

quotient_n16_3 = [1.0090,1.0090,1.0090,1.0089,1.0089,1.0088,1.0087,1.0084,1.0079,1.0075,1.0070,1.0067,1.0063,1.0060,1.0052, ...
    1.0044,1.0029,1.0014,0.9999,0.9984,0.9969,0.9954,0.9939,0.9910,0.9866,0.9793,0.9650,0.9512,0.9377,0.9246,0.9119,0.8995, ...
    0.8875,0.8758,0.8428,0.8223,0.8031,0.7763,0.7520,0.7444,0.7370,0.7299];


figure
semilogx(alpha_n6, quotient_n6, 'lineStyle','-', 'linewidth', 1, 'Marker', all_marks{1}, 'markersize', 4) 
hold on
semilogx(alpha_n8, quotient_n8, 'lineStyle','--', 'linewidth', 1, 'Marker', all_marks{2}, 'markersize', 4) 
hold on
semilogx(alpha_n10, quotient_n10, 'lineStyle',':', 'linewidth', 1, 'Marker', all_marks{3}, 'markersize', 4) 
hold on
semilogx(alpha_n16_3, quotient_n16_3, 'lineStyle','-.', 'linewidth', 1, 'Marker', all_marks{4}, 'markersize', 4) 


yline(1, '--', 'linewidth', 1);
grid on
legend('$\mathbf{P}_4$, $n=6^2$ mailles', '$\mathbf{P}_4$, $n=8^2$ mailles', '$\mathbf{P}_4$, $n=10^2$ mailles', '$\mathbf{P}_3$, $n=16^2$ mailles', ...
    'interpreter','latex', 'location', 'best');
xlabel('$\alpha$', 'interpreter','latex', 'fontsize', 14)
ylabel('$\frac{E(\varphi^{(1)}) - E(\varphi^{(2)})}{\alpha \; \delta E^{(1)}} $', 'interpreter', 'latex', 'fontsize', 15)


